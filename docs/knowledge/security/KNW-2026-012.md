# KNW-2026-012: User input in HTTP headers sanitiseren tegen header injection

## Metadata
- **Categorie:** security
- **Relevantie:** hoog
- **Datum:** 2026-02-28
- **Sessie-context:** D4 Export feature â€” review finding SEC-001

## Inzicht

User-supplied waarden die in HTTP response headers worden geplaatst (zoals `Content-Disposition`) moeten gevalideerd worden voordat ze in de header komen. Zonder validatie kan een aanvaller via newlines of speciale tekens extra headers injecteren (HTTP response splitting / header injection).

## Context

De `api_export_project` route plaatste de `slug` path parameter direct in de `Content-Disposition` header als filename: `attachment; filename="{slug}-sessions.md"`. Hoewel FastAPI enige bescherming biedt, is defense-in-depth vereist: de `validate_project_slug()` functie was al beschikbaar maar werd niet aangeroepen in deze nieuwe route.

## Geleerd

- **Altijd valideren bij grensovergangen:** Elke plek waar user input een andere context ingaat (HTML, SQL, HTTP headers, bestandssysteem) vereist validatie of escaping voor die specifieke context.
- **Bestaande validatiefuncties hergebruiken:** Als `validate_project_slug()` al bestaat voor andere routes, moet het ook in nieuwe routes worden gebruikt.
- **Content-Disposition is een veelvoorkomend doelwit:** Filename parameters in download headers zijn een klassiek injectiepunt.

## Toepassing

- Elke HTTP API die user input in response headers plaatst (niet alleen Content-Disposition, ook Location, Set-Cookie, etc.).
- Download endpoints die filenames genereren op basis van user input.
- Redirect endpoints die URLs construeren uit request parameters.
- OWASP: A03:2021 - Injection.

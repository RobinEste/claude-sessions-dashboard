# KNW-2026-010: Error handlers mogen geen interne details naar clients lekken

## Metadata
- **Categorie:** security
- **Relevantie:** hoog
- **Datum:** 2026-02-26
- **Sessie-context:** Structured error responses (C4) en review fix (MERGED-002)

## Inzicht

Generieke exception handlers die `str(exc)` doorgeven aan API-responses lekken interne implementatiedetails: bestandsnamen, padstructuren, limieten, en zelfs user-controlled input (reflected XSS in JSON). Log de volledige exception intern en stuur een generiek bericht naar de client.

## Context

De `ValueError` exception handler in FastAPI gaf `str(exc)` als `error`-veld terug. Dit lekte strings als `"File too large: _index.json (10485761 bytes, max 10485760)"` en `"Refusing to read symlink: sess_xxx.json"` — interne bestandsnamen en implementatiedetails. Validatiefuncties spiegelden bovendien user-controlled input terug, wat reflected content injection mogelijk maakt.

## Geleerd

- **Intern loggen, extern generaliseren:** `logger.warning("ValueError on %s: %s", request.url.path, exc)` intern, `"Invalid request"` naar de client.
- Error codes (bijv. `VALIDATION_ERROR`, `NOT_FOUND`) geven de client genoeg context om te reageren zonder implementatiedetails te onthullen.
- Dit geldt voor alle exception handlers, niet alleen `ValueError` — ook `JSONDecodeError`, `OSError`, etc.
- Check elke `raise ValueError(f"...")` in de codebase: bevat de message interne paden of user input?

## Toepassing

- Elke HTTP API met exception handlers (FastAPI, Flask, Django).
- CLI-tools die output naar stdout sturen die door andere tools wordt geparsed.
- Microservices die errors doorsturen naar andere services in een keten.
- OWASP Top 10: Information Disclosure (A01:2021 - Broken Access Control aanverwant).

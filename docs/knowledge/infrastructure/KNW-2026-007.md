# KNW-2026-007: GitHub Actions supply-chain hardening met SHA-pinning en permissions

## Metadata
- **Categorie:** infrastructure
- **Relevantie:** hoog
- **Datum:** 2026-02-25
- **Sessie-context:** Opzetten GitHub Actions CI pipeline (B1) en review-gedreven hardening

## Inzicht

Elke nieuwe GitHub Actions workflow moet twee security maatregelen bevatten: (1) SHA-pinning van alle third-party actions in plaats van mutable tags, en (2) een expliciet `permissions` block op workflow-niveau met minimale rechten. Zonder deze maatregelen kan een gecompromitteerde action tag of een te brede GITHUB_TOKEN de CI pipeline misbruiken.

## Context

De initiële CI workflow gebruikte `actions/checkout@v4` en `actions/setup-python@v5` — mutable tags die op elk moment naar andere code kunnen verwijzen. Standaard geeft GitHub een GITHUB_TOKEN met brede rechten (contents: write, packages: write, etc.).

De AI code review (infrastructure-reviewer agent) detecteerde beide issues als HIGH severity. Na fix bleek ook dat SHA-hashes geverifieerd moeten worden tegen de juiste versie — een verkeerd commentaar (`# v4.1.7` bij een v4.1.1 hash) werd in de vervolgingsreview gevonden.

## Geleerd

- Pin actions op volledige commit SHA met versie-commentaar: `actions/checkout@<sha> # v4.1.7`
- Verifieer dat de SHA daadwerkelijk bij de genoemde versie hoort (check via GitHub releases)
- Voeg `permissions: contents: read` toe voor CI-only workflows
- Dit is een eenmalige actie per workflow maar voorkomt een hele klasse supply-chain aanvallen

## Toepassing

Verplicht voor alle GitHub Actions workflows in elk project. Voeg toe aan CLAUDE.md als standaard conventie bij het aanmaken van nieuwe workflows.

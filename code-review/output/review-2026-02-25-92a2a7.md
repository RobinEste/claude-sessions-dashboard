# Code Review — 2026-02-25 (C3 + review fixes)

## Samenvatting

| Aspect | Waarde |
|--------|--------|
| **Verdict** | changes_requested |
| **Risk Score** | 100/100 (Hoog) |
| **Bestanden** | 4 gereviewed |
| **Bevindingen** | 7 (gefilterd van 19) |
| **Agents** | security-sentinel, logic-correctness, async-data-integrity, python-specialist, performance-reviewer, convention-checker, duplication-checker, dead-code-detector |

## Vereist menselijke beoordeling

### ASD-001 (CRITICAL) — OPGELOST
**Lock file verwijderd binnen lock block — locking invariant gebroken**
- `lib/store.py:718-740`
- Fix: `lock.unlink()` terugverplaatst naar na het `with _session_lock` block

### LOG-002 (HIGH) — OPGELOST
**Config-waarde voor `days` niet gevalideerd — nul archiveert alle sessies**
- `lib/store.py:748-752`
- Fix: `validate_positive_int(days)` ongeacht de bron (config of argument)

### ASD-002 (HIGH) — OPGELOST
**resume_session schrijft permanente placeholder outcome**
- `lib/store.py:549-579`
- Fix: pre-genereer session ID, schrijf definitieve outcome direct in lock block 1

## Overige bevindingen

### PRF-001 (MEDIUM) — OPGELOST
**validate_commits_json zonder maximale lijstlengte** → MAX_COMMITS = 500

### PYT-001 (MEDIUM) — OPGELOST
**Return value van validate_string_length genegeerd** → `name = validate_string_length(...)`

### LOG-001 (MEDIUM) — OPGELOST
**Lengte-check op ongestripte waarde** → strip eerst, check daarna

### PYT-003 (MEDIUM) — False positive
**add_task mist validatie** → delegeert al naar `add_tasks` dat valideert

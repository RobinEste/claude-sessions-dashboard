# Code Review — 2026-02-28

## Samenvatting

| Aspect | Waarde |
|--------|--------|
| **Verdict** | changes_requested |
| **Risk Score** | 40/100 (Matig) |
| **Bestanden** | 6 gereviewed |
| **Bevindingen** | 6 (gefilterd van 13) |
| **Agents** | security-sentinel, avg-privacy-guardian, logic-correctness, async-data-integrity, convention-checker, duplication-checker, python-specialist, dead-code-detector, performance-reviewer |

## Vereist menselijke beoordeling

### PRF-001 — Geen limiet op project export endpoint (HIGH)
**Bestand:** `web/app.py` | **Confidence:** 0.95

`api_export_project` roept `store.list_sessions(project_slug=slug)` aan zonder limiet. Alle sessies worden in één keer geladen en als één response teruggestuurd.

**Status:** FIXED — limiet parameter toegevoegd (default 100, max 500).

## Overige bevindingen

### SEC-001 — HTTP header injection via unvalidated slug (MEDIUM)
**Bestand:** `web/app.py:117-135` | **Confidence:** 0.80

De `slug` path parameter werd zonder validatie in de `Content-Disposition` header geplaatst.

**Status:** FIXED — `validate_project_slug(slug)` toegevoegd.

### CON-001 — datetime.now() zonder UTC (MEDIUM)
**Bestand:** `lib/export.py:190` | **Confidence:** 0.95

`datetime.now().astimezone()` was inconsistent met het codebase-patroon `datetime.now(UTC)`.

**Status:** FIXED — vervangen door `datetime.now(UTC).isoformat()`.

### DUP-001 — _task_summary() gedupliceerd (MEDIUM)
**Bestand:** `lib/export.py:47-55` | **Confidence:** 0.97

Identieke functie in `lib/store.py:1119-1127`. Gerelateerd aan SOL-2026-002.

**Status:** Niet gefixt — bewuste keuze. De export module is designed als standalone formatting module zonder dependency op store. De duplicatie is beperkt (9 regels) en de functies zijn simpel genoeg om onafhankelijk te onderhouden. De `_task_summary` in export.py is geoptimaliseerd naar single-pass iteratie.

### PYT-002 — API mist include_archived parameter (MEDIUM)
**Bestand:** `web/app.py:117-135` | **Confidence:** 0.95

CLI had `--include-archived`, API niet.

**Status:** FIXED — `include_archived` query parameter toegevoegd.

### PYT-004 — Fragiele heading-shift via str.replace (MEDIUM)
**Bestand:** `lib/export.py:209-212` | **Confidence:** 0.85

String replace voor heading-levels was fragiel en schaalde slecht.

**Status:** FIXED — `heading_level` parameter toegevoegd aan `export_session_markdown()`.
